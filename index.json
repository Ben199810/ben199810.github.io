[{"content":"","date":"2 July 2025","externalUrl":null,"permalink":"/tags/autoscaling/","section":"Tags","summary":"","title":"autoscaling","type":"tags"},{"content":"","date":"2 July 2025","externalUrl":null,"permalink":"/","section":"bing-wei's Blog","summary":"","title":"bing-wei's Blog","type":"page"},{"content":"","date":"2 July 2025","externalUrl":null,"permalink":"/tags/helm/","section":"Tags","summary":"","title":"helm","type":"tags"},{"content":"","date":"2 July 2025","externalUrl":null,"permalink":"/journals/","section":"Journals","summary":"","title":"Journals","type":"journals"},{"content":"","date":"2 July 2025","externalUrl":null,"permalink":"/tags/k8s/","section":"Tags","summary":"","title":"k8s","type":"tags"},{"content":"æœ€è¿‘åœ¨å‡ç´š helm release æ™‚é‡åˆ°äº†ä¸€å€‹éŒ¯èª¤ï¼Œæç¤º \u0026ldquo;no matches for kind HorizontalPodAutoscaler in version autoscaling/v2beta2\u0026rdquo;ã€‚\nåŸå› æ˜¯å› ç‚º Kubernetes çš„ API ç‰ˆæœ¬è®Šæ›´ï¼Œå°è‡´èˆŠçš„è³‡æºå®šç¾©ä¸å†åŒ¹é…æ–°çš„ API ç‰ˆæœ¬ã€‚\nè§£æ±ºæ–¹æ³• # å› ç‚ºæ˜¯æ­£å¼ç«™ç’°å¢ƒçš„ log æœå‹™ï¼Œlog çš„æ”¶é›†å° RD åœ¨æ’æŸ¥å•é¡Œæ™‚éå¸¸é‡è¦ã€‚å¦‚æœåˆªé™¤å¾Œå†é‡æ–°éƒ¨ç½²ï¼Œæœƒå°è‡´ log çš„ä¸Ÿå¤±ã€‚\nHelm3 æ”¯æ´ä¸€æ¬¾æ’ä»¶å·¥å…· mapkubeapisï¼Œå¯ä»¥å°‡æœ‰ä½¿ç”¨å·²æ£„ç”¨æˆ–å·²åˆªé™¤çš„ API çš„ Helm Release metadata æ›´æ–°ç‚ºæœ‰å—æ”¯æ´çš„ APIã€‚\nhelm mapkubeapis -n kube_namespace releaseName åƒè€ƒè³‡æ–™ # Helm upgrade failure due to deprecated or removed Kubernetes API ","date":"2 July 2025","externalUrl":null,"permalink":"/journals/k8s/kube-object-no-match-for-kind-version/","section":"Journals","summary":"æœ€è¿‘åœ¨å‡ç´š helm release æ™‚é‡åˆ°äº†ä¸€å€‹éŒ¯èª¤ï¼Œæç¤º \u0026ldquo;no matches for kind HorizontalPodAutoscaler in version autoscaling/v2beta2\u0026rdquo;ã€‚","title":"Kube Object No Match for Kind Version","type":"journals"},{"content":"","date":"2 July 2025","externalUrl":null,"permalink":"/tags/mapkubeapis/","section":"Tags","summary":"","title":"mapkubeapis","type":"tags"},{"content":"","date":"2 July 2025","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"2 July 2025","externalUrl":null,"permalink":"/tags/kubernetes/","section":"Tags","summary":"","title":"Kubernetes","type":"tags"},{"content":" ä»‹ç´¹ # PersistentVolume (PV) æ˜¯ Kubernetes ä¸­çš„ä¸€ç¨®è³‡æºï¼Œç”¨æ–¼æä¾›æŒä¹…åŒ–å­˜å„²ã€‚å®ƒæ˜¯é›†ç¾¤ç´šåˆ¥çš„å­˜å„²è³‡æºï¼Œèˆ‡ Pod çš„ç”Ÿå‘½é€±æœŸç„¡é—œã€‚PV å¯ä»¥è¢«å¤šå€‹ Pod å…±äº«ï¼Œä¸¦ä¸”å¯ä»¥åœ¨ Pod é‡å•Ÿæˆ–é‡æ–°èª¿åº¦æ™‚ä¿æŒæ•¸æ“šä¸è®Šã€‚\nç®¡ç†å“¡å¯ä»¥äº‹å…ˆå‰µå»º PVï¼Œä¸¦å°‡å…¶èˆ‡ç‰¹å®šçš„å­˜å„²ç³»çµ±ï¼ˆå¦‚ NFSã€iSCSIã€é›²å­˜å„²ç­‰ï¼‰ç¶å®šï¼Œæˆ–ä½¿ç”¨å‹•æ…‹å­˜å„²é¡åˆ¥ï¼ˆStorageClassï¼‰ä¾†è‡ªå‹•å‰µå»º PVã€‚\nPersistentVolumeClaim (PVC) æ˜¯ç”¨æˆ¶è«‹æ±‚å­˜å„²çš„æ–¹å¼ã€‚æ¦‚å¿µèˆ‡ Pod è«‹æ±‚è³‡æºé¡ä¼¼ã€‚ç”¨æˆ¶å¯ä»¥å‰µå»º PVCï¼ŒæŒ‡å®šæ‰€éœ€çš„å­˜å„²å¤§å°å’Œå­˜å–æ¨¡å¼ (å¦‚ ReadWriteOnceã€ReadOnlyMany ç­‰)ã€‚Kubernetes æœƒæ ¹æ“š PVC çš„è¦æ±‚ä¾†åŒ¹é…åˆé©çš„ PVã€‚\nå­˜å–æ¨¡å¼ # ReadWriteOnce (RWO)ï¼šå·åªèƒ½è¢«å–®å€‹ç¯€é»ä»¥è®€å¯«æ–¹å¼æ›è¼‰ã€‚ ReadOnlyMany (ROX)ï¼šå·å¯ä»¥è¢«å¤šå€‹ç¯€é»ä»¥åªè®€æ–¹å¼æ›è¼‰ã€‚ ReadWriteMany (RWX)ï¼šå·å¯ä»¥è¢«å¤šå€‹ç¯€é»ä»¥è®€å¯«æ–¹å¼æ›è¼‰ã€‚ PersistentVolume èˆ‡ PersistentVolumeClaim # graph pod(Pod) volume(Volume) PVC(PersistentVolumeClaim) PV(PersistentVolume) storageClass(StorageClass) storageProvider(StorageProvider) storage(Physical Storage) pod --\u003e|ä½¿ç”¨| volume --\u003e PVC PVC --\u003e|éœæ…‹ç¶å®š| PV PVC --\u003e|å‹•æ…‹ç¶å®š| storageClass PV --\u003e|æä¾›å­˜å„²| storage storageClass --\u003e|é…ç½®å­˜å„²| storageProvider --\u003e|å¯¦éš›å­˜å„²| storage å¦‚æœ PVC storageClassName å±¬æ€§ç‚º \u0026quot;\u0026quot;ï¼Œå‰‡è¡¨ç¤ºä½¿ç”¨éœæ…‹ç¶å®šã€‚é€™æ„å‘³è‘— PVC è‡ªèº«ç¦æ­¢ä½¿ç”¨å‹•æ…‹è£½å‚™çš„å·ã€‚\nåƒè€ƒ # [Kubernetes / K8s] PV/ PVC å„²å­˜å¤§å°äº‹äº¤çµ¦PV/PVCç®¡ç† æŒä¹…å· ","date":"2 July 2025","externalUrl":null,"permalink":"/posts/k8s/storage/","section":"Posts","summary":"ä»‹ç´¹ # PersistentVolume (PV) æ˜¯ Kubernetes ä¸­çš„ä¸€ç¨®è³‡æºï¼Œç”¨æ–¼æä¾›æŒä¹…åŒ–å­˜å„²ã€‚å®ƒæ˜¯é›†ç¾¤ç´šåˆ¥çš„å­˜å„²è³‡æºï¼Œèˆ‡ Pod çš„ç”Ÿå‘½é€±æœŸç„¡é—œã€‚PV å¯ä»¥è¢«å¤šå€‹ Pod å…±äº«ï¼Œä¸¦ä¸”å¯ä»¥åœ¨ Pod é‡å•Ÿæˆ–é‡æ–°èª¿åº¦æ™‚ä¿æŒæ•¸æ“šä¸è®Šã€‚","title":"PersistentVolume","type":"posts"},{"content":"","date":"2 July 2025","externalUrl":null,"permalink":"/posts/","section":"Posts","summary":"","title":"Posts","type":"posts"},{"content":"","date":"2 July 2025","externalUrl":null,"permalink":"/tags/storage/","section":"Tags","summary":"","title":"Storage","type":"tags"},{"content":" ä»‹ç´¹ # æ¯å€‹ StorageClass éƒ½åŒ…å« provisionerã€parametersã€reclaimPolicy é€™äº›å­—æ®µæœƒåœ¨ StorageClass éœ€è¦å‹•æ…‹é…ç½® PersistentVolume ä»¥æ»¿è¶³ PersistentVolumeClaim (PVC) ä½¿ç”¨åˆ°ã€‚\napiVersion: storage.k8s.io/v1 kind: StorageClass metadata: name: low-latency provisioner: csi-driver.example-vendor.example reclaimPolicy: Retain # é»˜è®¤å€¼æ˜¯ Delete allowVolumeExpansion: true mountOptions: - discard # è¿™å¯èƒ½ä¼šåœ¨å—å­˜å‚¨å±‚å¯ç”¨ UNMAP/TRIM volumeBindingMode: WaitForFirstConsumer parameters: guaranteedReadWriteLatency: \u0026#34;true\u0026#34; # è¿™æ˜¯æœåŠ¡æä¾›å•†ç‰¹å®šçš„ ç£ç¢Ÿå€æ’ä»¶ # æ¯å€‹ StorageClass éƒ½æœƒæœ‰ provisioner ï¼Œç”¨ä¾†æ±ºå®šä½¿ç”¨å“ªå€‹ç£ç¢Ÿå€æ’ä»¶ã€‚(å¿…è¦)\nå·æ’ä»¶ å…§ç½®è£½å‚™å™¨ é…ç½®ç¯„ä¾‹ AzureFile âœ“ Azure File CephFS - - FC - - FlexVolume - - iSCSI - - Local - Local NFS - NFS PortworxVolume âœ“ Portworx Volume RBD âœ“ Ceph RBD VsphereVolume âœ“ vSphere å›æ”¶ç­–ç•¥ # StorageClass å‹•æ…‹å»ºç«‹çš„ PersistentVolume æœƒåœ¨ reclaimPolicy æŒ‡å®šå›æ”¶ç­–ç•¥ï¼Œå¯ä»¥æ˜¯ Delete æˆ– Retain ã€‚é è¨­æ˜¯ Delete ã€‚\næ“´å±• # PersistentVolume å¯ä»¥é…ç½®ç‚ºå¯æ“´å……ï¼Œå…è¨±é€é PVC ç‰©ä»¶ä¾†èª¿æ•´ç£ç¢Ÿå€å¤§å°ï¼Œç”³è«‹ä¸€å€‹æ–°çš„ã€æ›´å¤§çš„å„²å­˜å®¹é‡ã€‚ç•¶ allowVolumeExpansion å®šç¾©ç‚º true æ™‚ï¼Œä¸‹åˆ—é¡å‹çš„ç£ç¢Ÿå€æ”¯æ´æ“´å……ã€‚\nå·é¡å‹ å·æ“´å±•çš„Kubernetes ç‰ˆæœ¬è¦æ±‚ Azure File 1.11 CSI 1.24 FlexVolume 1.13 Portworx 1.11 rbd 1.11 æ›è¼‰é¸é … # ç”± StorageClass å‹•æ…‹å»ºç«‹çš„ PersistentVolume å°‡ä½¿ç”¨é¡åˆ¥ä¸­ mountOptionsæŒ‡å®šçš„æ›è¼‰é¸é …ã€‚\nå¦‚æœç£ç¢Ÿå€æ’ä»¶ä¸æ”¯æ´æ›è¼‰é¸é …ï¼Œå»æŒ‡å®šäº†æ›è¼‰é¸é …ï¼Œå‰‡è£½å‚™æ“ä½œæœƒå¤±æ•—ã€‚ æ›è¼‰é¸é …åœ¨ StorageClass å’Œ PV ä¸Šéƒ½ä¸æœƒåšé©—è­‰ã€‚å¦‚æœå…¶ä¸­ä¸€å€‹æ›è¼‰é¸é …ç„¡æ•ˆï¼Œé‚£éº¼é€™å€‹PV æ›è¼‰ä½œæ¥­å°±æœƒå¤±æ•—ã€‚\nåƒè€ƒ # å‹•æ…‹å·è£½å‚™ ","date":"1 July 2025","externalUrl":null,"permalink":"/posts/k8s/storageclass/","section":"Posts","summary":"ä»‹ç´¹ # æ¯å€‹ StorageClass éƒ½åŒ…å« provisionerã€parametersã€reclaimPolicy é€™äº›å­—æ®µæœƒåœ¨ StorageClass éœ€è¦å‹•æ…‹é…ç½® PersistentVolume ä»¥æ»¿è¶³ PersistentVolumeClaim (PVC) ä½¿ç”¨åˆ°ã€‚","title":"StorageClass","type":"posts"},{"content":"","date":"24 September 2023","externalUrl":null,"permalink":"/tags/m1/","section":"Tags","summary":"","title":"m1","type":"tags"},{"content":"","date":"24 September 2023","externalUrl":null,"permalink":"/tags/m2/","section":"Tags","summary":"","title":"m2","type":"tags"},{"content":"","date":"24 September 2023","externalUrl":null,"permalink":"/tags/mac/","section":"Tags","summary":"","title":"mac","type":"tags"},{"content":"","date":"24 September 2023","externalUrl":null,"permalink":"/tags/minikube/","section":"Tags","summary":"","title":"minikube","type":"tags"},{"content":" ä»‹ç´¹ # minikube æ˜¯ä¸€å€‹è¼•é‡ç´šçš„ Kubernetes ç’°å¢ƒï¼Œä¸»è¦ç”¨æ–¼æœ¬åœ°é–‹ç™¼å’Œæ¸¬è©¦ã€‚å®ƒå¯ä»¥åœ¨æœ¬åœ°æ©Ÿå™¨ä¸Šå•Ÿå‹•ä¸€å€‹å–®ç¯€é»çš„ Kubernetes é›†ç¾¤ï¼Œè®“é–‹ç™¼è€…å¯ä»¥å¿«é€Ÿåœ°éƒ¨ç½²å’Œæ¸¬è©¦æ‡‰ç”¨ç¨‹å¼ã€‚\nminikube æ”¯æ´å¤šç¨®è™›æ“¬åŒ–æŠ€è¡“ï¼ŒåŒ…æ‹¬ VirtualBoxã€VMwareã€KVMã€Hyper-V ç­‰ç­‰ã€‚å®ƒå¯ä»¥åœ¨ Windowsã€macOS å’Œ Linux ä¸Šé‹è¡Œã€‚\nQemu # Qemu æ˜¯ä¸€å€‹é–‹æºçš„è™›æ“¬åŒ–è»Ÿé«”ï¼Œå¯ä»¥æ¨¡æ“¬å¤šç¨®ç¡¬é«”æ¶æ§‹ï¼ŒåŒ…æ‹¬ x86ã€ARMã€MIPS ç­‰ç­‰ã€‚å®ƒå¯ä»¥ç”¨æ–¼è™›æ“¬åŒ–å’Œæ¨¡æ“¬ä¸åŒçš„ä½œæ¥­ç³»çµ±å’Œæ‡‰ç”¨ç¨‹å¼ã€‚\nQemu çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š\nä½¿ç”¨è€…ç¨‹å¼æ¨¡æ“¬ï¼šQEMU èƒ½å¤ å°‡ç‚ºä¸€å€‹å¹³å°ç·¨è­¯çš„äºŒé€²ä½æª”æ¡ˆé‹è¡Œåœ¨å¦ä¸€å€‹ä¸åŒçš„å¹³å°ã€‚ ç³»çµ±è™›æ“¬åŒ–æ¨¡æ“¬ï¼šQEMU èƒ½å¤ æ¨¡æ“¬ä¸€å€‹å®Œæ•´çš„ç³»çµ±è™›æ“¬æ©Ÿï¼Œè©²è™›æ“¬æ©Ÿæœ‰è‡ªå·±çš„è™›æ“¬CPUã€æ™¶ç‰‡çµ„ã€è™›æ“¬è¨˜æ†¶é«”ä»¥åŠå„ç¨®è™›æ“¬å¤–éƒ¨è¨­å‚™ï¼Œèƒ½å¤ ç‚ºè™›æ“¬æ©Ÿä¸­é‹è¡Œçš„ä½œæ¥­ç³»çµ±å’Œæ‡‰ç”¨è»Ÿé«”å‘ˆç¾å‡ºèˆ‡å¯¦é«”é›»è…¦å®Œå…¨ä¸€è‡´çš„ç¡¬é«”è¦–åœ–ã€‚QEMUèƒ½å¤ æ¨¡æ“¬ x86ã€ARMã€MIPSã€PPC ç­‰å¤šå€‹å¹³å°ã€‚ Qemu åœ¨ macOS ä¸Šçš„ä½¿ç”¨ä¸»è¦æ˜¯ç‚ºäº†æ”¯æ´ M ç³»åˆ—æ™¶ç‰‡ï¼ˆå¦‚ M1ã€M2ï¼‰çš„è™›æ“¬åŒ–ï¼Œå› ç‚ºé€™äº›æ™¶ç‰‡ä½¿ç”¨ ARM æ¶æ§‹ï¼Œè€Œè¨±å¤šå‚³çµ±çš„è™›æ“¬åŒ–æŠ€è¡“ï¼ˆå¦‚ VirtualBoxï¼‰ä¸¦ä¸æ”¯æ´ ARM æ¶æ§‹ã€‚\nå®‰è£ # åœ¨ macOS ä¸Šå®‰è£ minikube å’Œ Qemuï¼Œå¯ä»¥ä½¿ç”¨ Homebrew ä¾†ç°¡åŒ–å®‰è£éç¨‹ã€‚ é¦–å…ˆï¼Œç¢ºä¿ä½ å·²ç¶“å®‰è£äº† Homebrewã€‚å¦‚æœé‚„æ²’æœ‰å®‰è£ï¼Œå¯ä»¥åƒè€ƒ Homebrew å®˜æ–¹ç¶²ç«™ é€²è¡Œå®‰è£ã€‚\nbrew install minikube brew install qemu æ¥è‘—ï¼Œç‚ºäº†è®“ minikube ä½¿ç”¨ Qemu ä½œç‚ºè™›æ“¬åŒ–é©…å‹•ç¨‹å¼ï¼Œæˆ‘å€‘éœ€è¦å®‰è£ socket_vmnetã€‚é€™æ˜¯ä¸€å€‹ç”¨æ–¼ macOS çš„ Qemu è™›æ“¬åŒ–ç¶²è·¯é©…å‹•ç¨‹å¼ã€‚\nbrew install socket_vmnet brew tap homebrew/services HOMEBREW=$(which brew) \u0026amp;\u0026amp; sudo ${HOMEBREW} services start socket_vmnet å•Ÿå‹• Minikube # åœ¨å®‰è£å®Œæˆå¾Œï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å•Ÿå‹• minikubeï¼Œä¸¦æŒ‡å®šä½¿ç”¨ Qemu ä½œç‚ºè™›æ“¬åŒ–é©…å‹•ç¨‹å¼ã€‚\nminikube start --driver qemu --network socket_vmnet åƒè€ƒè³‡æ–™ # How to Setup Minikube on MAC M1/M2 ","date":"24 September 2023","externalUrl":null,"permalink":"/posts/minikube/","section":"Posts","summary":"ä»‹ç´¹ # minikube æ˜¯ä¸€å€‹è¼•é‡ç´šçš„ Kubernetes ç’°å¢ƒï¼Œä¸»è¦ç”¨æ–¼æœ¬åœ°é–‹ç™¼å’Œæ¸¬è©¦ã€‚å®ƒå¯ä»¥åœ¨æœ¬åœ°æ©Ÿå™¨ä¸Šå•Ÿå‹•ä¸€å€‹å–®ç¯€é»çš„ Kubernetes é›†ç¾¤ï¼Œè®“é–‹ç™¼è€…å¯ä»¥å¿«é€Ÿåœ°éƒ¨ç½²å’Œæ¸¬è©¦æ‡‰ç”¨ç¨‹å¼ã€‚","title":"Minikube ç’°å¢ƒèˆ‡å®‰è£ (Mac M1/M2)","type":"posts"},{"content":"","date":"22 September 2023","externalUrl":null,"permalink":"/tags/cicd/","section":"Tags","summary":"","title":"cicd","type":"tags"},{"content":"","date":"22 September 2023","externalUrl":null,"permalink":"/tags/gitlab/","section":"Tags","summary":"","title":"gitlab","type":"tags"},{"content":" ä»‹ç´¹ # GitLab æ˜¯ä¸€å€‹é–‹æºçš„ DevOps å¹³å°ï¼Œæä¾›äº†ç‰ˆæœ¬æ§åˆ¶ã€CI/CDã€ä»£ç¢¼å¯©æŸ¥ç­‰åŠŸèƒ½ã€‚å®ƒçš„ CI/CD åŠŸèƒ½å¯ä»¥å¹«åŠ©é–‹ç™¼è€…è‡ªå‹•åŒ–è»Ÿé«”é–‹ç™¼æµç¨‹ï¼Œæé«˜é–‹ç™¼æ•ˆç‡å’Œè³ªé‡ã€‚\nGitLab çš„ CI/CD åŠŸèƒ½åŸºæ–¼ GitLab Runnerï¼Œå…è¨±é–‹ç™¼è€…å®šç¾©è‡ªå‹•åŒ–çš„å·¥ä½œæµç¨‹ï¼Œå¾ä»£ç¢¼æäº¤åˆ°éƒ¨ç½²ç”Ÿç”¢ç’°å¢ƒéƒ½å¯ä»¥è‡ªå‹•åŒ–å®Œæˆã€‚\nGitLab CI/CD çš„é…ç½®æ–‡ä»¶æ˜¯ .gitlab-ci.ymlï¼Œé€™å€‹æ–‡ä»¶å®šç¾©äº† CI/CD çš„å·¥ä½œæµç¨‹ï¼ŒåŒ…æ‹¬å„å€‹éšæ®µï¼ˆstagesï¼‰ã€ä»»å‹™ï¼ˆjobsï¼‰å’ŒåŸ·è¡Œçš„è…³æœ¬ï¼ˆscriptsï¼‰ã€‚é–‹ç™¼è€…å¯ä»¥æ ¹æ“šè‡ªå·±çš„éœ€æ±‚å®šç¾©ä¸åŒçš„å·¥ä½œæµç¨‹ï¼Œä¸¦ä¸”å¯ä»¥åœ¨ä¸åŒçš„éšæ®µä¸­åŸ·è¡Œä¸åŒçš„ä»»å‹™ã€‚\nåŸºæœ¬é…ç½® # ä»¥ä¸‹æ˜¯ä¸€å€‹ç°¡å–®çš„ .gitlab-ci.yml é…ç½®ç¯„ä¾‹ï¼ŒåŒ…å«äº†ä¸‰å€‹éšæ®µï¼štestã€build å’Œ deployã€‚\nstages: - test - build - deploy test: stage: test script: # å®šç¾© test éšæ®µçš„æŒ‡ä»¤ - echo \u0026#34;Running tests\u0026#34; # åŸ·è¡Œå–®å…ƒæ¸¬è©¦ã€ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥ç­‰ - npm test - npm run lint build: stage: build script: # å®šç¾© build éšæ®µçš„æŒ‡ä»¤ - echo \u0026#34;Building the application\u0026#34; - docker build -t $IMAGE_NAME:$TAG . # åªæœ‰ç•¶æ¸¬è©¦é€šéå¾Œæ‰åŸ·è¡Œ build needs: [\u0026#34;test\u0026#34;] deploy: stage: deploy script: # å®šç¾© deploy éšæ®µçš„æŒ‡ä»¤ - echo \u0026#34;Deploying to production\u0026#34; # åœ¨å¯¦éš›æƒ…æ³ä¸‹ï¼Œé€™è£¡å¯ä»¥æ˜¯éƒ¨ç½²åˆ° Kubernetesã€AWSã€GCP ç­‰çš„ç›¸æ‡‰æŒ‡ä»¤ # ä¹Ÿå¯ä»¥ä½¿ç”¨ Helm é€²è¡Œéƒ¨ç½² # åªæœ‰ç•¶ build æˆåŠŸå¾Œæ‰åŸ·è¡Œ deploy needs: [\u0026#34;build\u0026#34;] é€²éšé…ç½® # åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ï¼Œé€šå¸¸éœ€è¦æ›´è¤‡é›œçš„é…ç½®ï¼Œä¾‹å¦‚ï¼šé…ç½®ç’°å¢ƒè®Šæ•¸ã€å»ºæ§‹ mysql è³‡æ–™åº«ã€redis ç­‰æœå‹™ã€‚\nstages: - test - build - deploy test: stage: test services: - name: mysql:5.7 alias: db - redis:latest alias: redis variables: MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD} MYSQL_DATABASE: ${MYSQL_DATABASE} REDIS_PASSWORD: ${REDIS_PASSWORD} script: - echo \u0026#34;Running tests\u0026#34; - npm test - npm run lint build: stage: build script: - echo \u0026#34;Building the application\u0026#34; - docker build -t $IMAGE_NAME:$TAG . needs: [\u0026#34;test\u0026#34;] deploy: stage: deploy script: - echo \u0026#34;Deploying to production\u0026#34; needs: [\u0026#34;build\u0026#34;] parallel:matrix # âš ï¸ å°æ–¼ runner çš„é…ç½®ï¼Œå¿…é ˆè¦æœ‰å¤šå° runner æˆ–è€…é…ç½®å–®å° runner é…ç½®æ”¯æ´åŒæ™‚åŸ·è¡Œå¤šå€‹ä»»å‹™ã€‚\nâš ï¸ çŸ©é™£çš„æ’åˆ—æ•¸ä¸èƒ½è¶…é 200\nparallel å¯ä»¥åœ¨å–®ä¸€çš„ pipeline ä¸­åŒæ™‚åŸ·è¡Œå¤šå€‹ä»»å‹™ï¼Œé€™å°æ–¼éœ€è¦åœ¨å¤šå€‹ç’°å¢ƒæˆ–é…ç½®ä¸‹é‹è¡Œç›¸åŒä»»å‹™çš„æƒ…æ³éå¸¸æœ‰ç”¨ã€‚\nå¦‚æœéœ€è¦åœ¨ä¸åŒçš„ Node.js ç‰ˆæœ¬å’Œç’°å¢ƒä¸‹é‹è¡Œæ¸¬è©¦ï¼Œå¯ä»¥ä½¿ç”¨ parallel:matrix ä¾†å®šç¾©ä¸€å€‹çŸ©é™£ï¼Œé€™æ¨£å¯ä»¥åœ¨ä¸åŒçš„é…ç½®ä¸‹åŒæ™‚é‹è¡Œç›¸åŒçš„ä»»å‹™ã€‚\ntest: stage: test script: - echo \u0026#34;Running tests\u0026#34; parallel: matrix: - NODE_VERSION: [10, 12, 14] - ENV: [development, production] åƒè€ƒ # Parallel ","date":"22 September 2023","externalUrl":null,"permalink":"/posts/gitlab/cicd/","section":"Posts","summary":"ä»‹ç´¹ # GitLab æ˜¯ä¸€å€‹é–‹æºçš„ DevOps å¹³å°ï¼Œæä¾›äº†ç‰ˆæœ¬æ§åˆ¶ã€CI/CDã€ä»£ç¢¼å¯©æŸ¥ç­‰åŠŸèƒ½ã€‚å®ƒçš„ CI/CD åŠŸèƒ½å¯ä»¥å¹«åŠ©é–‹ç™¼è€…è‡ªå‹•åŒ–è»Ÿé«”é–‹ç™¼æµç¨‹ï¼Œæé«˜é–‹ç™¼æ•ˆç‡å’Œè³ªé‡ã€‚","title":"GitLab CICD","type":"posts"},{"content":"","date":"17 September 2023","externalUrl":null,"permalink":"/tags/cni/","section":"Tags","summary":"","title":"cni","type":"tags"},{"content":"","date":"17 September 2023","externalUrl":null,"permalink":"/tags/node/","section":"Tags","summary":"","title":"node","type":"tags"},{"content":"","date":"17 September 2023","externalUrl":null,"permalink":"/tags/pod/","section":"Tags","summary":"","title":"pod","type":"tags"},{"content":" å‰è¨€ # æœ€è¿‘å…¬å¸å°ˆæ¡ˆè½‰é›²ç«¯æ¶æ§‹æ™‚ï¼Œç”±æ–¼æœå‹™åªèƒ½å•Ÿç”¨ä¸€å€‹ pod æä¾›ç·šä¸Šæœå‹™çš„é‹ä½œï¼Œå› æ­¤ä¹Ÿé¸æ“‡ä½¿ç”¨ statefulSet éƒ¨ç½²æœå‹™ï¼Œåœ¨é€™éç¨‹ä¸­ç™¼ç¾çš„å•é¡Œã€‚\näº‹ä»¶æµç¨‹ # RD åŒä»æ›´æ–°äº† code åˆ° gitLabï¼Œä½†æ²’æœ‰é †åˆ©å®Œæˆ CICDã€‚åŸå› æ˜¯ StatefulSet pod åœ¨é—œé–‰æ™‚åœç•™åœ¨ terminating ç‹€æ…‹ã€‚é›–ç„¶ k8s æœ‰ terminationGracePeriodSeconds è¨­å®šï¼Œä½†ç”±æ–¼æƒ…æ³ç‰¹æ®Šï¼Œç•¶ä¸‹çš„ terminationGracePeriodSeconds è¨­ç‚º 14400 ç§’ï¼Œé•·é”å››å°æ™‚ã€‚\nå› ç‚ºç·šä¸Šç·Šæ€¥å•é¡Œï¼Œæ‰€ä»¥é‡å° terminating pod æ¡å–äº†å¼·åˆ¶åˆªé™¤ï¼škubectl delete pod [pod name] --grace-period=0 --forceã€‚ä¹‹å¾Œé‡æ–°å»ºç«‹çš„ pod å°±æœƒå‡ºç¾ä»¥ä¸‹éŒ¯èª¤è¨Šæ¯ ğŸ‘‡\nWarning (combined from similar events): Failed to create pod sandbox: rpo error: code = Unknown desc = failed to setup network for sandbox \u0026#34;14fe0cd3d688aed4ffed4c36ffab1a145230449881bcbe4cac6478a63412b0c*: plugin type=*gke\u0026#34; failed (add): container veth name provided (etho) already exists Google Support # å…¶å¯¦å‰é™£å­é€™å€‹éŒ¯èª¤å·²ç¶“å½±éŸ¿åˆ°é–‹ç™¼å’Œæ¸¬è©¦ç’°å¢ƒäº†ã€‚ç”±æ–¼é€™æ¬¡å½±éŸ¿åˆ°æ­£å¼ç’°å¢ƒï¼Œæˆ‘å€‘æŠŠæ¡ˆä»¶ç­‰ç´šæå‡è‡³ P1ï¼Œä¸¦è«‹ Google å”åŠ©æŸ¥æ‰¾éŒ¯èª¤ç™¼ç”Ÿçš„åŸå› ã€‚\nç¶“é Google å”åŠ©åˆ†æï¼Œé€™æ¬¡éŒ¯èª¤çš„ä¸»è¦åŸå› å¦‚ä¸‹ï¼š\nç•¶ pod é€²å…¥é—œé–‰æµç¨‹æ™‚ï¼Œç”±æ–¼ terminationGracePeriodSeconds è¨­ç½®ç‚ºå››å°æ™‚ï¼Œpod ä»è™•æ–¼ lifecycle ä¸­ æ­¤æ™‚ä½¿ç”¨ kubectl delete pod --force æœƒå°è‡´ pod é›–ç„¶æ¶ˆå¤±ï¼Œä½† container è¨­å®šä»æ®˜ç•™åœ¨ node ä¸Š å¦‚æœæ–°çš„ pod é‡æ–°åœ¨åŒä¸€é¡† node ä¸Šå•Ÿå‹•ï¼Œå°±æœƒé€ æˆç›¸åŒçš„ç¶²è·¯ä»‹é¢è¨­å®šè¡çª é›–ç„¶æ”¹æˆ Deployment å¯ä»¥è¦é¿æ­¤å•é¡Œï¼Œä½†ç›¸å°æœƒæµªè²»ä¸€çµ„ IPã€‚é•·ä¹…ä¸‹ä¾†ä¸€æ¨£æœƒæœ‰å•é¡Œï¼Œæœ€é‡è¦çš„é‚„æ˜¯è¦è®“ pod å®Œæ•´çµæŸæ•´å€‹ lifecycleï¼Œæ‰ä¸æœƒç”¢ç”Ÿå¾ŒçºŒå•é¡Œã€‚\næŠ€è¡“ç´°ç¯€è£œå…… # Container Network Interface (CNI) åœ¨ Kubernetes ä¸­è² è²¬ç®¡ç† Pod çš„ç¶²è·¯è¨­å®šã€‚ç•¶ Pod å•Ÿå‹•æ™‚ï¼ŒCNI æœƒç‚ºå…¶å‰µå»ºä¸€å€‹è™›æ“¬ç¶²è·¯ä»‹é¢ (veth pair)ï¼Œä¸¦å°‡å…¶é€£æ¥åˆ° Pod çš„ç¶²è·¯å‘½åç©ºé–“ã€‚\nåƒè€ƒè³‡æ–™ # Pods stuck on ContainerCreating after containerd is restarted ","date":"17 September 2023","externalUrl":null,"permalink":"/journals/k8s/veth-name-provided-already-exists/","section":"Journals","summary":"å‰è¨€ # æœ€è¿‘å…¬å¸å°ˆæ¡ˆè½‰é›²ç«¯æ¶æ§‹æ™‚ï¼Œç”±æ–¼æœå‹™åªèƒ½å•Ÿç”¨ä¸€å€‹ pod æä¾›ç·šä¸Šæœå‹™çš„é‹ä½œï¼Œå› æ­¤ä¹Ÿé¸æ“‡ä½¿ç”¨ statefulSet éƒ¨ç½²æœå‹™ï¼Œåœ¨é€™éç¨‹ä¸­ç™¼ç¾çš„å•é¡Œã€‚","title":"è§£æ±º Kubernetes Pod ç¶²è·¯è¡çªï¼šcontainer veth name provided (eth0) already exists","type":"journals"},{"content":"","date":"27 August 2023","externalUrl":null,"permalink":"/tags/docker/","section":"Tags","summary":"","title":"docker","type":"tags"},{"content":" Dockerfile # Dockerfile æ˜¯ Docker çš„æ ¸å¿ƒçµ„ä»¶ä¹‹ä¸€ï¼Œç”¨ä¾†å®šç¾©å¦‚ä½•å»ºæ§‹ä¸€å€‹ Docker æ˜ åƒæª”ï¼ˆimageï¼‰ã€‚å®ƒæ˜¯ä¸€å€‹æ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸€ç³»åˆ—çš„æŒ‡ä»¤å’Œåƒæ•¸ï¼Œé€™äº›æŒ‡ä»¤å‘Šè¨´ Docker å¦‚ä½•å¾åŸºç¤æ˜ åƒé–‹å§‹ï¼Œå®‰è£å¿…è¦çš„è»Ÿé«”ã€é…ç½®ç’°å¢ƒè®Šæ•¸ã€è¤‡è£½æª”æ¡ˆç­‰ã€‚\nå¯ä»¥ä¿è­‰æ¯æ¬¡ä½¿ç”¨ç›¸åŒçš„ Dockerfile å»ºæ§‹å‡ºä¾†çš„æ˜ åƒæª”éƒ½æ˜¯ä¸€è‡´çš„ï¼Œé€™å°æ–¼éƒ¨ç½²å’Œç¶­è­·æ‡‰ç”¨ç¨‹å¼éå¸¸é‡è¦ã€‚\né€™è£¡è¦æ³¨æ„ EXPOSEï¼Œå®ƒç”¨ä¾†å‘Šè¨´ Docker å“ªäº›ç«¯å£éœ€è¦æš´éœ²çµ¦å¤–éƒ¨è¨ªå•ã€‚ä½†æ˜¯é‚„æ˜¯å¿…é ˆè¦åœ¨ docker run æ™‚ä½¿ç”¨ -p é¸é …ä¾†å¯¦éš›æ˜ å°„ç«¯å£ã€‚\n# åŸºç¤æ˜ åƒï¼Œé€™è£¡ä½¿ç”¨ Alpine Linuxï¼Œå¦‚æœæ²’æœ‰æŒ‡å®š tagï¼Œå‰‡é»˜èªä½¿ç”¨ latest FROM alpine # è¨­å®šä½œè€…è³‡è¨Š LABEL maintainer=\u0026#34;bing-wei\u0026#34; # è¨­å®šå·¥ä½œç›®éŒ„ WORKDIR /app # è¤‡è£½ç•¶å‰ç›®éŒ„ä¸‹çš„æ‰€æœ‰æª”æ¡ˆåˆ°å®¹å™¨çš„ /app ç›®éŒ„ COPY . . # å®‰è£å¿…è¦çš„å¥—ä»¶ RUN apk add --no-cache python3 py3-pip # å®‰è£ Python ç›¸ä¾å¥—ä»¶ RUN pip3 install -r requirements.txt # è¨­å®šç’°å¢ƒè®Šæ•¸ ENV PYTHONUNBUFFERED=1 # æš´éœ²å®¹å™¨çš„ 8000 ç«¯å£ EXPOSE 8000 # è¨­å®šå®¹å™¨å•Ÿå‹•æ™‚åŸ·è¡Œçš„å‘½ä»¤ CMD [\u0026#34;python3\u0026#34;, \u0026#34;app.py\u0026#34;] å¤šéšæ®µå»ºæ§‹ # åœ¨å¯¦éš›çš„ç”Ÿç”¢ç’°å¢ƒä¸­ï¼Œé€šå¸¸æœƒä½¿ç”¨å¤šéšæ®µå»ºæ§‹ï¼ˆmulti-stage buildsï¼‰ä¾†æ¸›å°‘æœ€çµ‚æ˜ åƒæª”çš„å¤§å°ï¼Œé€™æ¨£å¯ä»¥åœ¨é–‹ç™¼éšæ®µå®‰è£æ‰€æœ‰å¿…è¦çš„å·¥å…·å’Œä¾è³´ï¼Œä½†åœ¨æœ€çµ‚æ˜ åƒæª”ä¸­åªä¿ç•™é‹è¡Œæ‡‰ç”¨ç¨‹å¼æ‰€éœ€çš„éƒ¨åˆ†ã€‚\n# ç¬¬ä¸€éšæ®µï¼šå»ºæ§‹éšæ®µ FROM node:14 AS build WORKDIR /app COPY package*.json ./ RUN npm install COPY . . RUN npm run build # ç¬¬äºŒéšæ®µï¼šé‹è¡Œéšæ®µ FROM nginx:alpine COPY --from=build /app/dist /usr/share/nginx/html EXPOSE 80 CMD [\u0026#34;nginx\u0026#34;, \u0026#34;-g\u0026#34;, \u0026#34;daemon off;\u0026#34;] å®‰å…¨æ€§è€ƒé‡ # åœ¨æ’°å¯« Dockerfile æ™‚ï¼Œé‚„éœ€è¦è€ƒæ…®å®‰å…¨æ€§å•é¡Œï¼Œä¾‹å¦‚ï¼š\nä½¿ç”¨å®˜æ–¹çš„åŸºç¤æ˜ åƒï¼Œé€™æ¨£å¯ä»¥æ¸›å°‘å®‰å…¨æ¼æ´çš„é¢¨éšªã€‚ é¿å…ä½¿ç”¨ latest æ¨™ç±¤ï¼Œå› ç‚ºé€™æ¨£æœƒå°è‡´æ˜ åƒæª”åœ¨ä¸åŒæ™‚é–“é»å¯èƒ½æœ‰ä¸åŒçš„å…§å®¹ï¼Œæ‡‰è©²ä½¿ç”¨å…·é«”çš„ç‰ˆæœ¬è™Ÿã€‚ å»ºç«‹å¸³è™Ÿå’Œè¨­å®šæ¬Šé™ï¼Œé¿å…ä½¿ç”¨ root å¸³è™Ÿé‹è¡Œæ‡‰ç”¨ç¨‹å¼ã€‚ # ä½¿ç”¨å®˜æ–¹çš„ Node.js æ˜ åƒ FROM node:14 # å»ºç«‹ä¸€å€‹é root ä½¿ç”¨è€… RUN useradd -m appuser # åˆ‡æ›åˆ°é root ä½¿ç”¨è€… USER appuser # è¨­å®šå·¥ä½œç›®éŒ„ WORKDIR /home/appuser/app # è¤‡è£½ package.json å’Œ package-lock.json COPY package*.json ./ # å®‰è£ç›¸ä¾å¥—ä»¶ RUN npm install --only=production # è¤‡è£½æ‡‰ç”¨ç¨‹å¼æª”æ¡ˆ COPY --chown=appuser:appuser . . # æš´éœ²æ‡‰ç”¨ç¨‹å¼ç«¯å£ EXPOSE 3000 # è¨­å®šå®¹å™¨å•Ÿå‹•å‘½ä»¤ CMD [\u0026#34;npm\u0026#34;, \u0026#34;start\u0026#34;] ","date":"27 August 2023","externalUrl":null,"permalink":"/posts/dockerfile/","section":"Posts","summary":"Dockerfile # Dockerfile æ˜¯ Docker çš„æ ¸å¿ƒçµ„ä»¶ä¹‹ä¸€ï¼Œç”¨ä¾†å®šç¾©å¦‚ä½•å»ºæ§‹ä¸€å€‹ Docker æ˜ åƒæª”ï¼ˆimageï¼‰ã€‚å®ƒæ˜¯ä¸€å€‹æ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸€ç³»åˆ—çš„æŒ‡ä»¤å’Œåƒæ•¸ï¼Œé€™äº›æŒ‡ä»¤å‘Šè¨´ Docker å¦‚ä½•å¾åŸºç¤æ˜ åƒé–‹å§‹ï¼Œå®‰è£å¿…è¦çš„è»Ÿé«”ã€é…ç½®ç’°å¢ƒè®Šæ•¸ã€è¤‡è£½æª”æ¡ˆç­‰ã€‚","title":"Dockerfile","type":"posts"},{"content":"","date":"19 August 2023","externalUrl":null,"permalink":"/tags/ingress/","section":"Tags","summary":"","title":"ingress","type":"tags"},{"content":"éš¨è‘—ç³»çµ±æ¶æ§‹æ—¥ç›Šè¤‡é›œï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å¤šå€‹ Ingress ä¾†åˆ†é›¢ä¸åŒæœå‹™çš„æµé‡ç®¡ç†ã€‚é€™æ¨£åšçš„å¥½è™•æ˜¯ç•¶æŸå€‹ Ingress ç™¼ç”Ÿç•°å¸¸æ™‚ï¼Œä¸æœƒå½±éŸ¿åˆ°æ‰€æœ‰æœå‹™çš„é‹ä½œã€‚\nä¸éç¼ºé»æ˜¯æ¯å€‹ Ingress éƒ½éœ€è¦ä½¿ç”¨éœæ…‹ IPï¼Œåœ¨ GCP ç­‰é›²ç«¯æœå‹™ä¸­ï¼Œæ¯å€‹ä¿ç•™çš„éœæ…‹ IP éƒ½æœƒå¢åŠ æˆæœ¬ã€‚\næˆ‘å€‘å¯ä»¥ä½¿ç”¨ Ingress Controller ä¾†çµ±ä¸€ç®¡ç†æ‰€æœ‰çš„ Ingress è³‡æºï¼Œåªä½¿ç”¨ä¸€å€‹æˆ–å°‘æ•¸å¹¾å€‹éœæ…‹ IPï¼Œé€™æ¨£å¯ä»¥é™ä½æˆæœ¬ä¸¦ç°¡åŒ–ç®¡ç†ã€‚\nä¸Šä¸€ç¯‡æ–‡ç« ä¸­æœ‰æåˆ° ingressï¼Œå¦‚æœæƒ³ç­è§£ ingress å¯ä»¥å…ˆåƒè€ƒæˆ–é ç¿’é€™ç¯‡æ–‡ç« ã€‚\nIngress 6 August 2023\u0026middot;1 åˆ†é˜ k8s ingress Ingress Nginx Controller # Ingress Nginx Controller çµåˆäº† Ingress çš„ç°¡æ½”ä¸¦æ”¯æ´ Nginx ç›¸é—œçš„æ“´å……åŠŸèƒ½ï¼Œè®“æˆ‘å€‘èƒ½æ›´å¥½çš„ç®¡ç†æ‰€æœ‰çš„ ingressã€‚\nNginx # é«˜æ•ˆèƒ½çš„ webServer é å‹å‚³çµ± apache server çš„è³‡æºèˆ‡æ•ˆèƒ½ å¤§é‡çš„æ¨¡çµ„èˆ‡æ“´å……åŠŸèƒ½ å……è¶³çš„å®‰å…¨æ€§åŠŸèƒ½ è¼•é‡ å®¹æ˜“æ°´å¹³æ“´å±• Ingress # Service é€£æ¥ LoadBalance è¨­å®š SSL/TLS çµ‚ç«¯ è™›æ“¬ä¸»æ©Ÿè¨­å®š å®‰è£ # helm upgrade --install ingress-nginx ingress-nginx \\ --repo https://kubernetes.github.io/ingress-nginx \\ --namespace ingress-nginx --create-namespace å¯¦éš›ç¯„ä¾‹ # åŸºæœ¬ Ingress è¨­å®š # apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: example-ingress annotations: kubernetes.io/ingress.class: \u0026#34;nginx\u0026#34; nginx.ingress.kubernetes.io/rewrite-target: / spec: rules: - host: example.com http: paths: - path: / pathType: Prefix backend: service: name: example-service port: number: 80 é€²éšè¨­å®šç¯„ä¾‹ # apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: advanced-ingress annotations: kubernetes.io/ingress.class: \u0026#34;nginx\u0026#34; nginx.ingress.kubernetes.io/ssl-redirect: \u0026#34;true\u0026#34; nginx.ingress.kubernetes.io/rate-limit: \u0026#34;10\u0026#34; cert-manager.io/cluster-issuer: \u0026#34;letsencrypt-prod\u0026#34; spec: tls: - hosts: - secure.example.com secretName: example-tls rules: - host: secure.example.com http: paths: - path: /api pathType: Prefix backend: service: name: api-service port: number: 8080 graph LR ingress1(Ingress-1) ingress2(Ingress-2) ingress3(Ingress-3) subgraph Ingress Nginx Controller controller(Controller) admission(Admission Webhook) nginx(Nginx) controller --\u003e|é…ç½®| nginx controller --\u003e|é©—è­‰| admission end ingress1 --\u003e|ç®¡ç†| controller ingress2 --\u003e|ç®¡ç†| controller ingress3 --\u003e|ç®¡ç†| controller åƒè€ƒè³‡æ–™ # ä½¿ç”¨ Helm ä¾†å®‰è£ Ingress Controller ingress-nginx ","date":"19 August 2023","externalUrl":null,"permalink":"/posts/k8s/ingress-nginx/","section":"Posts","summary":"éš¨è‘—ç³»çµ±æ¶æ§‹æ—¥ç›Šè¤‡é›œï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å¤šå€‹ Ingress ä¾†åˆ†é›¢ä¸åŒæœå‹™çš„æµé‡ç®¡ç†ã€‚é€™æ¨£åšçš„å¥½è™•æ˜¯ç•¶æŸå€‹ Ingress ç™¼ç”Ÿç•°å¸¸æ™‚ï¼Œä¸æœƒå½±éŸ¿åˆ°æ‰€æœ‰æœå‹™çš„é‹ä½œã€‚","title":"Ingress Nginx Controller","type":"posts"},{"content":" ä»‹ç´¹ # ingress æ˜¯ k8s çµ¦ service æä¾›å¤–éƒ¨è¨ªå•çš„ URLã€SSLã€è·¯ç”±ç­‰åŠŸèƒ½ã€‚ å¯ä»¥ç†è§£ç‚º nginx æˆ– traefik ç­‰çš„ä»£ç†å·¥å…·ã€‚å…è¨±é€éæŸå€‹ URL é€²å…¥å°æ‡‰çš„ serviceï¼Œä¸”ç¢°åˆ°æŸäº› route èƒ½å¤  proxy pass åˆ°å…¶ä»– serviceã€‚\nâ­ ingress åˆåˆ†æˆå¤–éƒ¨è² è¼‰å¹³è¡¡ã€å…§éƒ¨è² è¼‰å¹³è¡¡ã€‚å…©è€…åœ¨ä½¿ç”¨è¨­å®šä¸Šæœ‰ä¸€äº›å°å°çš„ä¸åŒã€‚\nå¤–éƒ¨è² è¼‰å¹³è¡¡ # é€šå¸¸å°å¤–éƒ¨çš„è² è¼‰å¹³è¡¡å…¥å£ï¼Œéƒ½æœƒè¨­ç½®é˜²ç«ç‰†æˆ–æ˜¯ç™½åå–®ç®¡ç†ä½†æ˜¯ k8s ingress å»ä¸èƒ½ç›´æ¥å¯¦ç¾ã€‚éœ€è¦é€éä¸€äº› gcp å…ƒä»¶åŠŸèƒ½ï¼Œä¾†è¨­ç½®é˜²ç«ç‰†æˆ–ç™½åå–®ç®¡ç†ã€‚\ncloud armor # armor çš„ç¿»è­¯æ˜¯æŒ‡ç›”ç”²çš„æ„æ€ï¼Œé€™æ˜¯ç”± gcp æä¾›çš„æœå‹™ï¼Œå…·æœ‰åˆ†æ•£å¼é˜»æ–·æ”»æ“Š(DDos)é˜²è­·æ©Ÿåˆ¶ã€ç¶²è·¯æ‡‰ç”¨ç¨‹å¼é˜²ç«ç‰†ã€‚å¯ä»¥æ­é… loadBalanceã€Cloud CDN ä¾†å¼·åŒ–ç¶²è·¯å®‰å…¨æœå‹™ã€‚\né‚£éº¼æˆ‘å€‘è¦å¦‚ä½•å°‡ cloud armor æ‡‰ç”¨åœ¨æˆ‘å€‘ ingress ä¸Šé¢å‘¢ï¼Ÿæ¥è‘—çœ‹ä¸‹å» ğŸ˜\né¦–å…ˆæˆ‘å€‘å¯ä»¥å…ˆæ‰¾å®˜æ–¹çš„ä½¿ç”¨æ‰‹å†Š Configuring Ingress using the default controller æ¥è‘—å°‡é‡é»æ”¾åœ¨ backendConfig è¨­å®šä¸Šé¢ï¼Œå‰é¢çš„ä»‹ç´¹å·²ç¶“çŸ¥é“ ingress è² è²¬ä¾æ“šè·¯ç”±è¦å‰‡ä»£ç†è½‰ç™¼ã€‚æ–‡ä»¶ä¸Š backenConfig èˆ‡ service å¯ä»¥è€¦åˆã€‚ä½¿ç”¨ backendConfig çš„è¨­å®šã€‚\nBackendConfig and FrontendConfig overview è©³ç´°æƒ³çŸ¥é“ backendConfig è¨­å®šç¯„ä¾‹å¯ä»¥åœ¨æ–‡ä»¶é€£æ¥å…§æ‰¾åˆ° ğŸ‘‰ Configuring Ingress features through BackendConfig parameters æ¥è‘—ä¸‹é¢ç¹ªè£½ä¸€å¼µå¤–éƒ¨è² è¼‰å¹³è¡¡çš„æ¶æ§‹åœ–ã€‚å¯ä»¥çœ‹åˆ°ä¸‹åœ–ä¸­ 114.1.46.157 çš„å®¢æˆ¶ç«¯åœ¨è¨ªå•çš„æ™‚å€™è¢« ingress çµ¦æ“‹ä¸‹äº†ã€‚\nåŸå› æ˜¯ ingress å¾Œç«¯ service æœ‰è€¦åˆ backendConfigï¼Œé€é backendConfig ä½¿ç”¨äº† cloud armorã€‚\nflowchart LR cli1(client 34.xxx.xxx.xxx) cli2(client 114.1.46.157) cli1 --\u003e ing cli2 --x ing subgraph k8s-cluster ing((ingress)) svc-web(web-service) svc-api(api-service) df-backend(backend-config) armor{{cloud-armor}} ing --\u003e svc-web ing --\u003e svc-api armor -.- df-backend df-backend -.-\u003e svc-web df-backend -.-\u003e svc-api end å…§éƒ¨è² è¼‰å¹³è¡¡ # è¬›å®Œäº†å¤–éƒ¨è² è¼‰å¹³è¡¡ï¼Œæ¥è‘—è¬› ingress æ“”ä»»å…§éƒ¨è² è¼‰å¹³è¡¡æ™‚ï¼Œéœ€è¦æ³¨æ„çš„äº‹é …ã€‚\nNetwork endpoint group # ä»€éº¼æ˜¯ NEG ?\nNEG æ˜¯æŒ‡ Network endpoint groupï¼Œæ˜¯ä¸€ç¨®é…ç½®ã€‚æ„æ€æ˜¯æŒ‡å®šä¸€çµ„å¾Œç«¯ endpoint æˆ– serviceï¼Œå€ŸåŠ©NEGï¼ŒGoogle Cloud è² è¼‰å‡è¡¡å™¨å¯ä»¥ç‚ºåŸºæ–¼ GCE çš„å·¥ä½œè² è¼‰ã€ç„¡æœå‹™å™¨å·¥ä½œè² è¼‰å’Œå®¹å™¨åŒ–å·¥ä½œè² è¼‰æä¾›æœå‹™ã€‚å¯ä»¥æ›´ç²¾ç´°çš„å°‡æµé‡åˆ†é…åˆ°è² è¼‰å‡è¡¡å™¨çš„å¾Œç«¯ã€‚\nä½¿ç”¨æ™‚ï¼Œå°å¾Œç«¯çš„ service å¿…é ˆè¦ä½¿ç”¨ NEGï¼Œè©³ç´°æƒ³è¦äº†è§£å¯ä»¥åƒè€ƒ ğŸ‘‰ Network endpoint groups overview ","date":"6 August 2023","externalUrl":null,"permalink":"/posts/k8s/ingress/","section":"Posts","summary":"ä»‹ç´¹ # ingress æ˜¯ k8s çµ¦ service æä¾›å¤–éƒ¨è¨ªå•çš„ URLã€SSLã€è·¯ç”±ç­‰åŠŸèƒ½ã€‚ å¯ä»¥ç†è§£ç‚º nginx æˆ– traefik ç­‰çš„ä»£ç†å·¥å…·ã€‚å…è¨±é€éæŸå€‹ URL é€²å…¥å°æ‡‰çš„ serviceï¼Œä¸”ç¢°åˆ°æŸäº› route èƒ½å¤  proxy pass åˆ°å…¶ä»– serviceã€‚","title":"Ingress","type":"posts"},{"content":" åŒ¯å‡º/åŒ¯å…¥ # export å’Œ save éƒ½æ˜¯ç”¨ä¾†åŒ¯å‡º docker çš„æ˜ åƒæª”ï¼Œä½†æ˜¯æœ‰äº›ä¸åŒä¹‹è™•ï¼š\nexport å¯ä»¥åŒ¯å‡ºåœ¨å®¹å™¨ä¸­å·²è®Šæ›´çš„è¨­å®šï¼Œä¾‹å¦‚å®‰è£çš„è»Ÿé«”æˆ–ä¿®æ”¹çš„é…ç½®æª”æ¡ˆã€‚ save å–®ç´”åŒ¯å‡ºæ˜ åƒæª”ï¼Œä¸åŒ…å«åœ¨å®¹å™¨ä¸­å·²è®Šæ›´çš„è¨­å®šã€‚ åœ¨ä½¿ç”¨ä¸Šè¦æ³¨æ„ï¼Œå¦‚æœæ˜ åƒæª”ä½¿ç”¨ export åŒ¯å‡ºï¼Œå‰‡éœ€è¦ä½¿ç”¨ import åŒ¯å…¥ï¼›å¦‚æœä½¿ç”¨ save åŒ¯å‡ºï¼Œå‰‡éœ€è¦ä½¿ç”¨ load åŒ¯å…¥ã€‚\ndocker export image \u0026gt; filename.tar docker import \u0026lt; filename.tar docker save image \u0026gt; filename.tar docker load \u0026lt; filename.tar èˆ‡å®¹å™¨é€²è¡Œäº¤äº’ # é€šå¸¸æˆ‘å€‘æœƒä½¿ç”¨ docker run æŒ‡ä»¤ä¾†å•Ÿå‹•å®¹å™¨ï¼Œå¦‚æœéœ€è¦èˆ‡å®¹å™¨é€²è¡Œäº¤äº’ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹é¸é …ï¼š\ndocker run -it image /bin/bash å¦‚æœè¦é€€å‡ºå®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨ exit æˆ– ctrl+dã€‚\næŸ¥çœ‹å®¹å™¨ # å¦‚æœè¦æŸ¥çœ‹æ­£åœ¨é‹è¡Œçš„å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ docker psï¼Œå¦‚æœè¦æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢çš„å®¹å™¨ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ docker ps -aã€‚\ndocker ps -a æŸ¥çœ‹å®¹å™¨å…§çš„æ¨™æº–è¼¸å‡º # å¦‚æœè¦æŸ¥çœ‹å®¹å™¨å…§çš„æ¨™æº–è¼¸å‡ºï¼Œå¯ä»¥ä½¿ç”¨ docker logs ï¼Œä½†æ˜¯é€šå¸¸æˆ‘å€‘æœƒæŒçºŒçš„è§€å¯Ÿå®¹å™¨çš„æ¨™æº–è¼¸å‡ºï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ -f é¸é …ä¾†æŒçºŒæŸ¥çœ‹ã€‚\ndocker logs -f container æŸ¥çœ‹å®¹å™¨å•Ÿå‹•é€²ç¨‹ # docker top container å®¹å™¨è³‡æºä½¿ç”¨ç‹€æ³ # docker stats æ¸…ç†æŠ€å·§ # â­ pruneæ“ä½œæ˜¯æ‰¹é‡åˆªé™¤é¡çš„å±éšªæ“ä½œï¼Œä½¿ç”¨ y ç¢ºèªã€‚ä¸æƒ³è¦è¼¸å…¥å¯ä»¥æ·»åŠ  -fï¼Œæ…ç”¨!\næ¸…é™¤æ‰€æœ‰åœæ­¢é‹è¡Œçš„å®¹å™¨ # docker container prune æ¸…ç†æœªä½¿ç”¨çš„æ˜ åƒæª” # docker image prune æ¸…ç†æ‰€æœ‰ç„¡ç”¨çš„å· # docker volume prune åƒè€ƒ # æ¸…ç† Docker çš„ containerï¼Œimage èˆ‡ volume ","date":"30 July 2023","externalUrl":null,"permalink":"/posts/docker/","section":"Posts","summary":"åŒ¯å‡º/åŒ¯å…¥ # export å’Œ save éƒ½æ˜¯ç”¨ä¾†åŒ¯å‡º docker çš„æ˜ åƒæª”ï¼Œä½†æ˜¯æœ‰äº›ä¸åŒä¹‹è™•ï¼š","title":"Docker","type":"posts"},{"content":"","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series","type":"series"}]